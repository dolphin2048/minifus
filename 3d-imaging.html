<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>三维结构 - Dolphin阵列超声研究平台</title>
    <link rel="stylesheet" href="style.css">
    <style>
        #viewer-container {
            width: 100%;
            height: 500px;
            position: relative;
            background-color: #e0e0e0; /* A light gray background for the viewer */
        }
        #viewer-container canvas {
            display: block;
        }
        #loading-indicator {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #333;
            font-size: 1.2rem;
        }
    </style>
</head>
<body>
    <header>
        <h1>Dolphin阵列超声研究平台</h1>
        <p>一款面向超声领域科学家的高性能开放式研究平台</p>
    </header>

    <nav>
        <ul>
            <li><a href="index.html">首页</a></li>
            <li><a href="platform-details.html">技术与规格</a></li>
            <li><a href="applications.html">典型应用</a></li>
            <li><a href="3d-imaging.html" class="active">3D成像</a></li>
            <li><a href="contact.html">联系我们</a></li>
        </ul>
    </nav>

    <main>
        <section id="3d-imaging">
            <h2>三维结构</h2>
            <div class="content-grid">
                <div class="text-content">
                    <h3>高精度三维结构展示</h3>
                    <p>本页面展示了Dolphin平台的三维结构模型。我们能够精确捕捉设备结构的空间细节。</p>
                    <p>该模型具备以下特点：</p>
                    <ul>
                        <li>结构具备良好的电磁屏蔽能力，抑制外界干扰</li>
                        <li>设备体积紧凑，占用空间小，适合集成应用</li>
                        <li>设备结构内部结构化设计，便于维护，支持外壳定制</li>
                    </ul>
                    <p>您可以在下方的窗口中通过拖动鼠标来旋转、缩放和平移3D模型。</p>
                    <a href="images/3d_model_archive.zip" download="3d_model_archive.zip" class="button" style="margin-top: 1rem; display: inline-block;">下载结构文件 (.zip)</a>
                </div>
                <div id="viewer-container">
                    <div id="loading-indicator">正在加载3D模型...</div>
                </div>
            </div>
        </section>

        <section id="exploded-view">
            <h2>内部结构爆炸图</h2>
            <div class="content-grid">
                <div class="text-content">
                    <h3>核心部件解析</h3>
                    <p>通过爆炸视图，可以清晰地观察到Dolphin平台内部的核心组件布局。每一个部件都经过精心设计和优化，以确保最高的性能和可靠性。</p>
                    <ul>
                        <li>多通道收发单元</li>
                        <li>高精度时钟同步模块</li>
                        <li>高速光纤通信模块</li>
                    </ul>
                </div>
                <div class="image-content">
                    <img src="images/internal-exploded-view.png" alt="内部结构爆炸图">
                    <p class="caption">Dolphin平台内部结构</p>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <p>中国科学院声学研究所</p>
        <p>&copy; 2025 Dolphin. All Rights Reserved.</p>
    </footer>

    <!-- Import Three.js and necessary loaders -->
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.164.1/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.164.1/examples/jsm/"
            }
        }
    </script>
    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
        import { OBJLoader } from 'three/addons/loaders/OBJLoader.js';

        let scene, camera, renderer, controls;

        function init() {
            const container = document.getElementById('viewer-container');
            const loadingIndicator = document.getElementById('loading-indicator');

            // Scene
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0xf4f8fa);

            // Camera
            camera = new THREE.PerspectiveCamera(75, container.clientWidth / container.clientHeight, 0.1, 1000);
            camera.position.z = 5;

            // Renderer
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(container.clientWidth, container.clientHeight);
            container.appendChild(renderer.domElement);

            // Controls
            controls = new OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;

            // Lighting
            const ambientLight = new THREE.AmbientLight(0xffffff, 1.5);
            scene.add(ambientLight);
            const directionalLight = new THREE.DirectionalLight(0xffffff, 2);
            directionalLight.position.set(5, 10, 7.5).normalize();
            scene.add(directionalLight);

            // OBJ Loader
            const loader = new OBJLoader();
            loader.load(
                'ICE0423_x_t.obj',
                function (object) {
                    // Hide loading indicator
                    loadingIndicator.style.display = 'none';

                    // Center the model
                    const box = new THREE.Box3().setFromObject(object);
                    const center = box.getCenter(new THREE.Vector3());
                    object.position.sub(center);
                    scene.add(object);

                    // Adjust camera to fit the model
                    const size = box.getSize(new THREE.Vector3());
                    const maxDim = Math.max(size.x, size.y, size.z);
                    const fov = camera.fov * (Math.PI / 180);
                    let cameraZ = Math.abs(maxDim / 2 / Math.tan(fov / 2));
                    cameraZ *= 1.5; // Zoom out a bit
                    camera.position.z = cameraZ;
                    camera.updateProjectionMatrix();
                    controls.target.copy(center);
                    controls.update();
                },
                function (xhr) {
                    const percentLoaded = (xhr.loaded / xhr.total * 100).toFixed(0);
                    loadingIndicator.innerText = `正在加载3D模型... ${percentLoaded}%`;
                },
                function (error) {
                    console.error('加载3D模型时出错:', error);
                    loadingIndicator.innerText = '加载模型失败。';
                }
            );

            window.addEventListener('resize', onWindowResize, false);
            animate();
        }

        function onWindowResize() {
            const container = document.getElementById('viewer-container');
            if (container) {
                camera.aspect = container.clientWidth / container.clientHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(container.clientWidth, container.clientHeight);
            }
        }

        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
        }

        init();
    </script>
</body>
</html>
