<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>三维实时成像 - Dolphin阵列超声研究平台</title>
    <link rel="stylesheet" href="style.css">
    <style>
        #viewer-container {
            width: 100%;
            height: 500px;
            position: relative;
            background-color: #e0e0e0; /* A light gray background for the viewer */
        }
        #viewer-container canvas {
            display: block;
        }
        #loading-indicator {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #333;
            font-size: 1.2rem;
        }
    </style>
</head>
<body>
    <header>
        <h1>Dolphin阵列超声研究平台</h1>
        <p>一款面向超声领域科学家的高性能开放式研究平台</p>
    </header>

    <nav>
        <ul>
            <li><a href="index.html">首页</a></li>
            <li><a href="technology.html">技术原理</a></li>
            <li><a href="specs.html">产品规格</a></li>
            <li><a href="applications.html">典型应用</a></li>
            <li><a href="3d-imaging.html" class="active">3D成像</a></li>
            <li><a href="contact.html">联系我们</a></li>
        </ul>
    </nav>

    <main>
        <section id="3d-imaging">
            <h2>三维实时成像</h2>
            <div class="content-grid">
                <div class="text-content">
                    <h3>探索三维视界</h3>
                    <p>Dolphin平台支持先进的三维实时成像技术，能够以前所未有的细节和深度，实时捕捉和重建三维结构。这项功能为复杂生物结构的动态研究和高精度工业无损检测开辟了新的可能性。</p>
                    <ul>
                        <li>高分辨率三维容积成像</li>
                        <li>实时动态血流可视化</li>
                        <li>支持自定义探头和成像序列</li>
                    </ul>
                    <p>您可以在下方的窗口中通过拖动鼠标来旋转、缩放和平移3D模型。</p>
                </div>
                <div id="viewer-container">
                    <div id="loading-indicator">正在加载3D模型...</div>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <p>中国科学院声学研究所</p>
        <p>&copy; 2025 Dolphin. All Rights Reserved.</p>
    </footer>

    <!-- Import Three.js and necessary loaders -->
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.164.1/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.164.1/examples/jsm/"
            }
        }
    </script>
    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
        import { OBJLoader } from 'three/addons/loaders/OBJLoader.js';

        let scene, camera, renderer, controls;

        function init() {
            const container = document.getElementById('viewer-container');
            const loadingIndicator = document.getElementById('loading-indicator');

            // Scene
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0xf4f8fa);

            // Camera
            camera = new THREE.PerspectiveCamera(75, container.clientWidth / container.clientHeight, 0.1, 1000);
            camera.position.z = 5;

            // Renderer
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(container.clientWidth, container.clientHeight);
            container.appendChild(renderer.domElement);

            // Controls
            controls = new OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;

            // Lighting
            const ambientLight = new THREE.AmbientLight(0xffffff, 1.5);
            scene.add(ambientLight);
            const directionalLight = new THREE.DirectionalLight(0xffffff, 2);
            directionalLight.position.set(5, 10, 7.5).normalize();
            scene.add(directionalLight);

            // OBJ Loader
            const loader = new OBJLoader();
            loader.load(
                'ICE0423_x_t.obj',
                function (object) {
                    // Hide loading indicator
                    loadingIndicator.style.display = 'none';

                    // Center the model
                    const box = new THREE.Box3().setFromObject(object);
                    const center = box.getCenter(new THREE.Vector3());
                    object.position.sub(center);
                    scene.add(object);

                    // Adjust camera to fit the model
                    const size = box.getSize(new THREE.Vector3());
                    const maxDim = Math.max(size.x, size.y, size.z);
                    const fov = camera.fov * (Math.PI / 180);
                    let cameraZ = Math.abs(maxDim / 2 / Math.tan(fov / 2));
                    cameraZ *= 1.5; // Zoom out a bit
                    camera.position.z = cameraZ;
                    camera.updateProjectionMatrix();
                    controls.target.copy(center);
                    controls.update();
                },
                function (xhr) {
                    const percentLoaded = (xhr.loaded / xhr.total * 100).toFixed(0);
                    loadingIndicator.innerText = `正在加载3D模型... ${percentLoaded}%`;
                },
                function (error) {
                    console.error('加载3D模型时出错:', error);
                    loadingIndicator.innerText = '加载模型失败。';
                }
            );

            window.addEventListener('resize', onWindowResize, false);
            animate();
        }

        function onWindowResize() {
            const container = document.getElementById('viewer-container');
            if (container) {
                camera.aspect = container.clientWidth / container.clientHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(container.clientWidth, container.clientHeight);
            }
        }

        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
        }

        init();
    </script>
</body>
</html>